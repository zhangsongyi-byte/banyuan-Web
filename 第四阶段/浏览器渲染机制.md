# 浏览器渲染机制

本次只讨论，浏览器收到html文件之后，怎么做解析的。

1. 处理 HTML 标记并构建 DOM 树。
2. 处理 CSS 标记并构建 CSSOM 树。
3. 将 DOM 与 CSSOM 合并成一个渲染树（render tree）。
4. 根据渲染树来布局，以计算每个节点的几何信息。
5. 将各个节点绘制到屏幕上。

![浏览器渲染](/Users/touitsuchou/Documents/workspace/banyuan/课件/前端/img/浏览器渲染.png)

### 重绘：

重绘（repaint）：当render tree中的一些元素需要更新属性，而这些属性只是影响元素的外观、风格，而不会影响布局的，比如background-color。



### 回流：

回流（reflow）：当render tree中的一部分(或全部)因为元素的规模尺寸、布局、某些属性等改变而需要重新构建。每个页面至少需要一次回流，就是在页面第一次加载的时候，这时候是一定会发生回流的，因为要构建render tree。



#### 会引起回流的操作：

- 页面首次渲染
- 浏览器窗口大小发生改变
- 元素尺寸或位置发生改变
- 元素内容变化（文字数量或图片大小等等）
- 元素字体大小变化
- 添加或者删除**可见**的`DOM`元素
- 激活`CSS`伪类（例如：`:hover`）
- 查询某些属性或调用某些方法



### 想一想：

**回流必将引起重绘，重绘不一定会引起回流**





### 性能：

显然的，回流比重绘的代价要高很多。

试想，有时候，仅仅回流一个单一元素，但是它的父类元素或者任何和它相关的元素都会跟着改动。所以在优化的时候，需要尽量的减少回流。



